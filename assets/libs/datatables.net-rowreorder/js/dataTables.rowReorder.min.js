/*! For license information please see dataTables.rowReorder.min.js.LICENSE.txt */
!function(t){var e,o;"function"==typeof define&&define.amd?define(["jquery","datatables.net"],(function(e){return t(e,window,document)})):"object"==typeof exports?(e=require("jquery"),o=function(t,e){e.fn.dataTable||require("datatables.net")(t,e)},"undefined"==typeof window?module.exports=function(r,n){return r=r||window,n=n||e(r),o(r,n),t(n,r,r.document)}:(o(window,e),module.exports=t(e,window,window.document))):t(jQuery,window,document)}((function(t,e,o){"use strict";function r(e,o){if(!n.versionCheck||!n.versionCheck("1.11"))throw"DataTables RowReorder requires DataTables 1.11 or newer";if(this.c=t.extend(!0,{},n.defaults.rowReorder,r.defaults,o),this.s={bodyTop:null,dt:new n.Api(e),getDataFn:n.util.get(this.c.dataSrc),middles:null,scroll:{},scrollInterval:null,setDataFn:n.util.set(this.c.dataSrc),start:{top:0,left:0,offsetTop:0,offsetLeft:0,nodes:[],rowIndex:0},windowHeight:0,documentOuterHeight:0,domCloneOuterHeight:0,dropAllowed:!0},this.dom={clone:null,cloneParent:null,dtScroll:t("div.dataTables_scrollBody, div.dt-scroll-body",this.s.dt.table().container())},e=(o=this.s.dt.settings()[0]).rowreorder)return e;this.dom.dtScroll.length||(this.dom.dtScroll=t(this.s.dt.table().container(),"tbody")),(o.rowreorder=this)._constructor()}var n=t.fn.dataTable,s=(t.extend(r.prototype,{_constructor:function(){var e=this,o=this.s.dt,r=t(o.table().node());"static"===r.css("position")&&r.css("position","relative"),t(o.table().container()).on("mousedown.rowReorder touchstart.rowReorder",this.c.selector,(function(r){var n,s;if(e.c.enable)return!!t(r.target).is(e.c.excludedChildren)||(n=t(this).closest("tr"),(s=o.row(n)).any()?(e._emitEvent("pre-row-reorder",{node:s.node(),index:s.index()}),e._mouseDown(r,n),!1):void 0)})),o.on("destroy.rowReorder",(function(){t(o.table().container()).off(".rowReorder"),o.off(".rowReorder")})),this._keyup=this._keyup.bind(this)},_cachePositions:function(){var r=this.s.dt,n=t(r.table().node()).find("thead").outerHeight(),s=t.unique(r.rows({page:"current"}).nodes().toArray());s=t.map(s,(function(e,o){var r=t(e).position().top-n;return(r+r+t(e).outerHeight())/2}));this.s.middles=s,this.s.bodyTop=t(r.table().body()).offset().top,this.s.windowHeight=t(e).height(),this.s.documentOuterHeight=t(o).outerHeight(),this.s.bodyArea=this._calcBodyArea()},_clone:function(e){var o=this.s.dt,r=(o=t(o.table().node().cloneNode(!1)).addClass("dt-rowReorder-float").append("<tbody/>").append(e.clone(!1)),e.outerWidth()),n=e.outerHeight(),s=(i=t(t(this.s.dt.table().node()).parent())).width(),i=i.scrollLeft(),d=e.children().map((function(){return t(this).width()}));o.width(r).height(n).find("tr").children().each((function(t){this.style.width=d[t]+"px"})),e=t("<div>").addClass("dt-rowReorder-float-parent").width(s).append(o).appendTo("body").scrollLeft(i);this.dom.clone=o,this.dom.cloneParent=e,this.s.domCloneOuterHeight=o.outerHeight()},_clonePosition:function(t){var e=this.s.start,o=this._eventToPage(t,"Y")-e.top,r=(t=this._eventToPage(t,"X")-e.left,this.c.snapX);o+=e.offsetTop,r=!0===r?e.offsetLeft:"number"==typeof r?e.offsetLeft+r:t+e.offsetLeft+this.dom.cloneParent.scrollLeft();o<0?o=0:o+this.s.domCloneOuterHeight>this.s.documentOuterHeight&&(o=this.s.documentOuterHeight-this.s.domCloneOuterHeight),this.dom.cloneParent.css({top:o,left:r})},_emitEvent:function(e,o){var r;return this.s.dt.iterator("table",(function(n,s){void 0!==(n=t(n.nTable).triggerHandler(e+".dt",o))&&(r=n)})),r},_eventToPage:function(t,e){return(-1!==t.type.indexOf("touch")?t.originalEvent.touches[0]:t)["page"+e]},_mouseDown:function(r,n){var s=this,i=this.s.dt,d=this.s.start,l=this.c.cancelable,a=n.offset();d.top=this._eventToPage(r,"Y"),d.left=this._eventToPage(r,"X"),d.offsetTop=a.top,d.offsetLeft=a.left,d.nodes=t.unique(i.rows({page:"current"}).nodes().toArray()),this._cachePositions(),this._clone(n),this._clonePosition(r),a=this._eventToPage(r,"Y")-this.s.bodyTop,d.rowIndex=this._calcRowIndexByPos(a),(this.dom.target=n).addClass("dt-rowReorder-moving"),t(o).on("mouseup.rowReorder touchend.rowReorder",(function(t){s._mouseUp(t)})).on("mousemove.rowReorder touchmove.rowReorder",(function(t){s._mouseMove(t)})),t(e).width()===t(o).width()&&t(o.body).addClass("dt-rowReorder-noOverflow"),i=this.dom.dtScroll;this.s.scroll={windowHeight:t(e).height(),windowWidth:t(e).width(),dtTop:i.length?i.offset().top:null,dtLeft:i.length?i.offset().left:null,dtHeight:i.length?i.outerHeight():null,dtWidth:i.length?i.outerWidth():null},l&&t(o).on("keyup",this._keyup)},_mouseMove:function(e){this._clonePosition(e);for(var o,r,n=this.s.start,s=this.c.cancelable,i=(s&&(o=this.s.bodyArea,r=this._calcCloneParentArea(),this.s.dropAllowed=this._rectanglesIntersect(o,r),this.s.dropAllowed?t(this.dom.cloneParent).removeClass("drop-not-allowed"):t(this.dom.cloneParent).addClass("drop-not-allowed")),this._eventToPage(e,"Y")-this.s.bodyTop),d=this.s.middles,l=null,a=0,c=d.length;a<c;a++)if(i<d[a]){l=a;break}null===l&&(l=d.length),s&&(this.s.dropAllowed||(l=n.rowIndex>this.s.lastInsert?n.rowIndex+1:n.rowIndex),this.dom.target.toggleClass("dt-rowReorder-moving",this.s.dropAllowed)),this._moveTargetIntoPosition(l),this._shiftScroll(e)},_mouseUp:function(e){var o=this,r=this.s.dt,n=this.c.dataSrc;if(this.s.dropAllowed){for(var s,i,d,l=this.s.start.nodes,a=t.unique(r.rows({page:"current"}).nodes().toArray()),c={},h=[],u=[],f=this.s.getDataFn,w=this.s.setDataFn,p=0,g=l.length;p<g;p++)l[p]!==a[p]&&(s=r.row(a[p]).id(),i=r.row(a[p]).data(),d=r.row(l[p]).data(),s&&(c[s]=f(d)),h.push({node:a[p],oldData:f(i),newData:f(d),newPosition:p,oldPosition:t.inArray(a[p],l)}),u.push(a[p]));var m,v=[h,{dataSrc:n,nodes:u,values:c,triggerRow:r.row(this.dom.target),originalEvent:e}];!1===this._emitEvent("row-reorder",v)?o._cancel():(this._cleanupDragging(),m=function(){if(o.c.update){for(p=0,g=h.length;p<g;p++){var t=r.row(h[p].node).data();w(t,h[p].newData),r.columns().every((function(){this.dataSrc()===n&&r.cell(h[p].node,this.index()).invalidate("data")}))}o._emitEvent("row-reordered",v),r.draw(!1)}},this.c.editor?(this.c.enable=!1,this.c.editor.edit(u,!1,t.extend({submit:"changed"},this.c.formOptions)).multiSet(n,c).one("preSubmitCancelled.rowReorder",(function(){o.c.enable=!0,o.c.editor.off(".rowReorder"),r.draw(!1)})).one("submitUnsuccessful.rowReorder",(function(){r.draw(!1)})).one("submitSuccess.rowReorder",(function(){m()})).one("submitComplete",(function(){o.c.enable=!0,o.c.editor.off(".rowReorder")})).submit()):m())}else o._cancel()},_moveTargetIntoPosition:function(e){var o,r,n=this.s.dt;null!==this.s.lastInsert&&this.s.lastInsert===e||(o=t.unique(n.rows({page:"current"}).nodes().toArray()),"",r=e>this.s.lastInsert?(this.dom.target.insertAfter(o[e-1]),"after"):(this.dom.target.insertBefore(o[e]),"before"),this._cachePositions(),this.s.lastInsert=e,this._emitEvent("row-reorder-changed",{insertPlacement:r,insertPoint:e,row:n.row(this.dom.target)}))},_cleanupDragging:function(){var e=this.c.cancelable;this.dom.clone.remove(),this.dom.cloneParent.remove(),this.dom.clone=null,this.dom.cloneParent=null,this.dom.target.removeClass("dt-rowReorder-moving"),t(o).off(".rowReorder"),t(o.body).removeClass("dt-rowReorder-noOverflow"),clearInterval(this.s.scrollInterval),this.s.scrollInterval=null,e&&t(o).off("keyup",this._keyup)},_shiftScroll:function(r){var n,s,i=this,d=this.s.scroll,l=!1,a=r.pageY-o.body.scrollTop;a<t(e).scrollTop()+65?n=-5:a>d.windowHeight+t(e).scrollTop()-65&&(n=5),null!==d.dtTop&&r.pageY<d.dtTop+65?s=-5:null!==d.dtTop&&r.pageY>d.dtTop+d.dtHeight-65&&(s=5),n||s?(d.windowVert=n,d.dtVert=s,l=!0):this.s.scrollInterval&&(clearInterval(this.s.scrollInterval),this.s.scrollInterval=null),!this.s.scrollInterval&&l&&(this.s.scrollInterval=setInterval((function(){var e;d.windowVert&&(e=t(o).scrollTop(),t(o).scrollTop(e+d.windowVert),e!==t(o).scrollTop())&&(e=parseFloat(i.dom.cloneParent.css("top")),i.dom.cloneParent.css("top",e+d.windowVert)),d.dtVert&&(e=i.dom.dtScroll[0],d.dtVert)&&(e.scrollTop+=d.dtVert)}),20))},_calcBodyArea:function(e){var o=this.s.dt,r=t(o.table().body()).offset();return{left:r.left,top:r.top,right:r.left+t(o.table().body()).width(),bottom:r.top+t(o.table().body()).height()}},_calcCloneParentArea:function(e){var o=t(this.dom.cloneParent).offset();return{left:o.left,top:o.top,right:o.left+t(this.dom.cloneParent).width(),bottom:o.top+t(this.dom.cloneParent).height()}},_rectanglesIntersect:function(t,e){return!(t.left>=e.right||e.left>=t.right||t.top>=e.bottom||e.top>=t.bottom)},_calcRowIndexByPos:function(e){var o=this.s.dt,r=t.unique(o.rows({page:"current"}).nodes().toArray()),n=-1,s=t(o.table().node()).find("thead").outerHeight();return t.each(r,(function(o,r){var i=t(r).position().top-s;r=i+t(r).outerHeight();i<=e&&e<=r&&(n=o)})),n},_keyup:function(t){this.c.cancelable&&27===t.which&&(t.preventDefault(),this._cancel())},_cancel:function(){var t=(t=this.s.start).rowIndex>this.s.lastInsert?t.rowIndex+1:t.rowIndex;this._moveTargetIntoPosition(t),this._cleanupDragging(),this._emitEvent("row-reorder-canceled",[this.s.start.rowIndex])}}),r.defaults={dataSrc:0,editor:null,enable:!0,formOptions:{},selector:"td:first-child",snapX:!1,update:!0,excludedChildren:"a",cancelable:!1},t.fn.dataTable.Api);return s.register("rowReorder()",(function(){return this})),s.register("rowReorder.enable()",(function(t){return void 0===t&&(t=!0),this.iterator("table",(function(e){e.rowreorder&&(e.rowreorder.c.enable=t)}))})),s.register("rowReorder.disable()",(function(){return this.iterator("table",(function(t){t.rowreorder&&(t.rowreorder.c.enable=!1)}))})),r.version="1.5.0",t.fn.dataTable.RowReorder=r,t.fn.DataTable.RowReorder=r,t(o).on("init.dt.dtr",(function(e,o,s){var i,d;"dt"===e.namespace&&(e=o.oInit.rowReorder,i=n.defaults.rowReorder,e||i)&&(d=t.extend({},e,i),!1!==e)&&new r(o,d)})),n}));