$(document).ready((function(){"use strict";console.log("DOM loaded. Initializing calendar..."),function(){const e=new Date;var t=$("#today-date");t.length&&t.text(e.toLocaleDateString("en-US",{day:"numeric",month:"long",year:"numeric"}))}();var e=new Date,t=e.getFullYear(),a=e.getMonth(),n=[{id:"2",title:"Team Meeting",start:new Date(t,a,4),className:"bg-primary border-0 text-white",allDay:!0,extendedProps:{description:"Weekly team sync-up meeting."}},{id:"3",title:"All Day Event",start:new Date(t,a,12),className:"bg-info border-0 text-white",allDay:!0,extendedProps:{description:"General all-day event."}},{id:"5",title:"Kids' Sports Day",start:new Date(t,a,15),className:"bg-secondary border-0 text-white",allDay:!0,extendedProps:{description:"A fun sports event for kids."}},{id:"7",title:"Repeating Event",start:new Date(t,a,24),end:new Date(t,a,27),className:"bg-success border-0 text-white",allDay:!0,extendedProps:{description:"A repeating event over multiple days."}},{id:"8",title:"Project Deadline",start:new Date(t,a,26),className:"bg-danger border-0 text-white",allDay:!0,extendedProps:{description:"Final submission deadline for project."}}];function r(e){if(!e)return null;var t=(e=e.trim()).match(/^(\d{1,2}):(\d{2})$/);if(t)return t[1].padStart(2,"0")+":"+t[2]+":00";if(t=e.match(/^\s*(\d{1,2}):(\d{2})\s*([AP]M)\s*$/i)){var a=parseInt(t[1],10),n=t[2],r=t[3].toUpperCase();return"PM"===r&&a<12&&(a+=12),"AM"===r&&12===a&&(a=0),String(a).padStart(2,"0")+":"+n+":00"}return null}function i(e,t){var a=new Date(e);return a.setHours(a.getHours()+t),a.getFullYear()+"-"+String(a.getMonth()+1).padStart(2,"0")+"-"+String(a.getDate()).padStart(2,"0")+"T"+String(a.getHours()).padStart(2,"0")+":"+String(a.getMinutes()).padStart(2,"0")+":"+String(a.getSeconds()).padStart(2,"0")}var d=1e3;function l(){return String(d+=1)}var s=$("#calendar");if(s.length){var o=new FullCalendar.Calendar(s[0],{timeZone:"local",initialView:"dayGridMonth",selectable:!0,editable:!0,dayMaxEvents:!0,headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},events:n,eventDisplay:"block",displayEventTime:!0,displayEventEnd:!1,eventTimeFormat:{hour:"numeric",minute:"2-digit",meridiem:!0},eventContent:function(e){return{html:'<span class="fc-event-title">'+e.event.title+"</span>"}},dateClick:function(e){$("#eventStartDate").val(e.dateStr),$("#eventEndDate").val(e.dateStr),new bootstrap.Modal($("#addEventModal")[0]).show()},eventClick:function(e){$("#detailTitle").text(e.event.title),$("#detailStart").text(e.event.startStr||"N/A"),$("#detailEnd").text(e.event.endStr||"N/A"),$("#detailDesc").text(e.event.extendedProps?.description||"(no description)"),$("#editEventBtn").attr("data-event-id",e.event.id),$("#deleteEventBtn").attr("data-event-id",e.event.id),new bootstrap.Modal($("#eventDetailsModal")[0]).show()}});o.render(),$("#addEventForm").on("submit",(function(e){e.preventDefault();var t=$("#eventTitle").val().trim(),a=$("#eventStartDate").val(),n=$("#eventEndDate").val(),d=$("#eventTime").val().trim(),s=$("#eventColor").val(),v=$("#eventDescription").val().trim();if(!t||!a)return alert("Please provide Title and Start Date");var c,p=r(d),g={Primary:"bg-primary",Success:"bg-success",Secondary:"bg-secondary",Info:"bg-info",Danger:"bg-danger"};if(p){var D=a+"T"+p,m=n&&n!==a?n+"T"+p:i(D,1);c={id:l(),title:t,start:D,end:m,allDay:!1,className:(g[s]||"bg-primary")+" text-white border-0",extendedProps:{description:v}}}else{D=a,m=null;if(n&&n!==a){var u=new Date(n);u.setDate(u.getDate()+1),m=u.toISOString().split("T")[0]}c={id:l(),title:t,start:D,end:m,allDay:!0,className:(g[s]||"bg-primary")+" text-white border-0",extendedProps:{description:v}}}o.addEvent(c),o.refetchEvents(),o.render(),bootstrap.Modal.getInstance($("#addEventModal")[0]).hide(),this.reset()})),$("#deleteEventBtn").on("click",(function(){var e=$(this).attr("data-event-id"),t=o.getEventById(e);t&&t.remove(),bootstrap.Modal.getInstance($("#eventDetailsModal")[0]).hide()})),$("#editEventBtn").on("click",(function(){var e=$(this).attr("data-event-id"),t=o.getEventById(e);if(t){$("#editEventId").val(t.id),$("#editEventTitle").val(t.title);var a=t.start.toISOString();if($("#editEventStartDate").val(a.split("T")[0]),t.end)if(t.allDay){var n=new Date(t.end);n.setDate(n.getDate()-1),$("#editEventEndDate").val(n.toISOString().split("T")[0])}else $("#editEventEndDate").val(t.end.toISOString().split("T")[0]);else $("#editEventEndDate").val("");$("#editEventDescription").val(t.extendedProps?.description||""),$("#editEventTime").val(!t.allDay&&t.start?t.start.toTimeString().slice(0,5):""),bootstrap.Modal.getInstance($("#eventDetailsModal")[0]).hide(),new bootstrap.Modal($("#editEventModal")[0]).show()}})),$("#editEventForm").on("submit",(function(e){e.preventDefault();var t=$("#editEventId").val(),a=o.getEventById(t);if(a){var n=$("#editEventTitle").val().trim(),d=$("#editEventStartDate").val(),l=$("#editEventEndDate").val(),s=$("#editEventTime").val().trim(),v=$("#editEventColor").val(),c=$("#editEventDescription").val().trim(),p=r(s),g={Primary:"bg-primary",Success:"bg-success",Secondary:"bg-secondary",Info:"bg-info",Danger:"bg-danger"};if(p){var D=d+"T"+p,m=l&&l!==d?l+"T"+p:i(D,1);a.setProp("title",n),a.setStart(D),a.setEnd(m),a.setAllDay(!1),a.setExtendedProp("description",c),a.setProp("classNames",(g[v]||"bg-primary")+" text-white border-0")}else{D=d,m=null;if(l&&l!==d){var u=new Date(l);u.setDate(u.getDate()+1),m=u.toISOString().split("T")[0]}a.setProp("title",n),a.setStart(D),a.setEnd(m),a.setAllDay(!0),a.setExtendedProp("description",c),a.setProp("classNames",(g[v]||"bg-primary")+" text-white border-0")}bootstrap.Modal.getInstance($("#editEventModal")[0]).hide()}}))}else console.error("Calendar element not found!")}));